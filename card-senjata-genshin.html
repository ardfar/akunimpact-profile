<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AkunImpact</title>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @font-face {
            font-family: "genshin";
            src: url("assets/fonts/genshin.ttf");
        }


        .genshin-card {
            position: relative;
            font-family: "genshin";
        }

        /* Container for the small part */
        .corner-container {
            position: absolute;
            top: 0;
            right: 0;
            z-index: 1; /* Ensure it's above the image */
        }

        /* Styles for the small part */
        .genshin-corner-part {
            width: 2rem;
            height: 2rem;
            border-bottom-left-radius: 10px;
            background: #a36b5e ;
            color: #edc681;
            display: flex;
            align-items: center;
            justify-content: center;
            visibility: hidden; /* Hide by default */
        }

        .genshin-card.selected .genshin-corner-part {
            visibility: visible; /* Show only when selected */
        }

        .genshin-corner-part p {
            font-size: 1rem;
            color: #edc681;
            margin: 0;
        }
    </style>
</head>
<body class="p-8 bg-gray-700">
    <div id="imageContainer" class="flex flex-wrap justify-center relative">
        <!-- Images will be dynamically added here -->
    </div>

    <input type="hidden" class="h-[500px] w-[700px]" id="jsonDataWeapon" name="jsonDataWeapon" />

    <button onclick="extractData()" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Extract Data</button>

    <button onclick="resetSelections()" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded mt-4">Reset Selections</button>


    <script>
        const weapon_bow_ghenshin = {
            "amos-bow.webp": "Amos Bow",
            "aqua-simulacra.webp": "Aqua Simulacra",
            "elegy-for-the-end.webp": "Elegy for the End",
            "hunter_s-path.webp": "Hunter's Path",
            "polar-star.webp": "Polar Star",
            "skyward-harp.webp": "Skyward Harp",
            "the-first-great-magic.webp": "The First Great Magic",
            "thundering-pulse.webp": "Thundering Pulse",
        };

        const weapon_catalyst_genshin = {
            "a-thousand-floating-dreams.webp": "A Thousand Floating Dreams",
            "cashflow-supervision.webp": "Cashflow Supervision",
            "cranes-echoing-call.webp": "Cranes Echoing Call",
            "everlasting-moonglow.webp": "Everlasting Moonglow",
            "jadefall-splendor.webp": "Jadefall Splendor",
            "kagura_s-verity.webp": "Kagura's Verity",
            "lost-prayer-to-the-sacred-winds.webp": "Lost Prayer to the Sacred Winds",
            "memory-of-dust.webp": "Memory of Dust",
            "skyward-atlas.webp": "Skyward Atlas",
            "tome-of-the-eternal-flow.webp": "Tome of the Eternal Flow",
            "tulaytullah_s-remembrance.webp": "Tulaytullah's Remembrance",
        }

        const weapon_claymore_genshin = {
            "beacon-of-the-reed-sea.webp": "Beacon of the Reed Sea",
            "redhorn-stonethresher.webp": "Redhorn Stonethresher",
            "skyward-pride.webp": "Skyward Pride",
            "song-of-broken-pines.webp": "Song of Broken Pines",
            "the-unforged.webp": "The Unforged",
            "verdict.webp": "Verdict",
            "wolf_s-gravestone.webp": "Wolf's Gravestone",            
        }

        const weapon_polearm_genshin = {
            "calamity-queller.webp": "Calamity Queller",
            "engulfing-lightning.webp": "Engulfing Lightning",
            "primordial-jade-winged-spear.webp": "Primordial Jade Winged Spear",
            "skyward-spine.webp": "Skyward Spine",
            "staff-of-homa.webp": "Staff of Homa",
            "staff-of-the-scarlet-sands.webp": "Staff of the Scarlet Sands",
            "vortex-vanquisher.webp": "Vortex Vanquisher",            
        }

        const weapon_sword_genshin = {
            "aquila-favonia.webp": "Aquila Favonia",
            "freedom-sworn.webp": "Freedom Sworn",
            "haran-geppaku-futsu.webp": "Haran Geppaku Futsu",
            "key-of-khaj-nisut.webp": "Key of Khaj-Nisut",
            "light-of-foliar-incision.webp": "Light of Foliar Incision",
            "mistsplitter-reforged.webp": "Mistsplitter Reforged",
            "primordial-jade-cutter.webp": "Primordial Jade Cutter",
            "skyward-blade.webp": "Skyward Blade",
            "splendor-of-tranquil-waters.webp": "Splendor of Tranquil Waters",
            "summit-shaper.webp": "Summit Shaper",
            "uraku-misugiri.webp": "Uraku Misugiri"            
        }


        // Function to fetch images from the JSON file
        function fetchImages() {
            const imageContainer = document.getElementById('imageContainer');

            const weaponCategories = [
                { category: weapon_bow_ghenshin, folder: 'bow' },
                { category: weapon_catalyst_genshin, folder: 'catalyst' },
                { category: weapon_claymore_genshin, folder: 'claymore' },
                { category: weapon_polearm_genshin, folder: 'polearm' },
                { category: weapon_sword_genshin, folder: 'sword' }
            ];

            for (const { category, folder } of weaponCategories) {
                for (const [filename, weaponName] of Object.entries(category)) {
                    // Create Card 
                    const card = document.createElement('div');
                    card.classList.add('genshin-card', 'bg-white', 'rounded-lg', 'cursor-pointer', 'w-[150px]', 'max-h-[250px]', 'pb-2', 'overflow-hidden', 'transition', 'duration-300', 'ease-in-out', 'cursor-pointer', 'm-2', 'flex', 'flex-col', 'items-center', 'justify-center');
                    card.setAttribute('data-clicks', '0');
                    card.setAttribute('title', 'Click to Select Weapon');
                    card.setAttribute('data-weapon-name', weaponName); // Simpan nama karakter di sini
                    card.onclick = function() { toggleSelected(this); };

                    // Corner Container
                    const cornerContainer = document.createElement('div');
                    cornerContainer.classList.add('corner-container');
                    const cornerPart = document.createElement('div');
                    cornerPart.classList.add('genshin-corner-part', 'border-red-600');
                    cornerContainer.appendChild(cornerPart);
                    card.appendChild(cornerContainer);

                    // Character Image 
                    const img = document.createElement('img');
                    img.classList.add('w-full', 'h-[75%]', 'object-scale-down', 'bg-[#c7c7c7]', "rounded-br-3xl");
                    img.src = `assets/images/games/genshin/weapons/${folder}/${filename}`;
                    img.alt = 'Character Image';

                    // Char Name
                    const weaponNameElement = document.createElement('p');
                    weaponNameElement.classList.add('text-black', 'transition', 'duration-300', 'ease-in-out', 'text-center', 'bg-none', 'm-auto', 'px-2');
                    weaponNameElement.textContent = weaponName;

                    card.appendChild(img);
                    card.appendChild(weaponNameElement);
                    imageContainer.appendChild(card);
                }
            }
        }

        // Function to toggle the 'selected' class on click
        function toggleSelected(card) {
            const clicks = parseInt(card.getAttribute('data-clicks'));
            var image = card.getElementsByTagName("img")[0]
            console.log("Click: ", clicks)
            
            if (clicks < 6){
                image.classList.remove("bg-[#c7c7c7]")
                image.classList.add("bg-[#efa525]")

                card.classList.add('selected');
                card.querySelector('.genshin-corner-part').innerHTML = `<p>R${clicks}</p>`;
            } else {
                image.classList.remove("bg-[#efa525]")
                image.classList.add("bg-[#c7c7c7]")

                card.classList.remove('selected');
                card.querySelector('.genshin-corner-part').innerHTML = '';
            }

            card.setAttribute('data-clicks', clicks < 6 ? clicks + 1 : 0);
        }

        // Function to extract data from selected cards
        function extractData() {
            const selectedCards = document.querySelectorAll('.genshin-card.selected');
            const data = {
                characters: Array.from(selectedCards).map(card => ({
                    name: card.getAttribute('data-character-name'), // Ambil nama karakter langsung dari atribut data
                    enhancement: parseInt(card.getAttribute('data-clicks')) % 7
                }))
            };
            const jsonDataGenshinCharacterInput = document.getElementById('jsonDataGenshinCharacter');
            jsonDataGenshinCharacterInput.value = JSON.stringify(data);
            console.log(jsonDataGenshinCharacterInput.value); // Output JSON for debugging
        }

        // Fetch images when the page loads
        window.onload = function() {
            fetchImages();
        };

        // Function to reset all selected images
        function resetSelections() {
            const selectedCards = document.querySelectorAll('.genshin-card.selected');
            for (const card of selectedCards) {
                const image = card.getElementsByTagName("img")[0];
                image.classList.remove("bg-[#efa525]");
                image.classList.add("bg-[#c7c7c7]");
                card.classList.remove('selected');
                card.querySelector('.genshin-corner-part').innerHTML = '';
                card.setAttribute('data-clicks', '0');
            }
        }

    </script>
</body>
</html>